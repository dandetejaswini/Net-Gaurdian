/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/nsfwjs@4.2.1/dist/esm/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as e from"/npm/@tensorflow/tfjs@4.22.0/+esm";import{Buffer as t}from"/npm/buffer@6.0.3/+esm";var n="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},r={0:"Drawing",1:"Hentai",2:"Neutral",3:"Porn",4:"Sexy"},o=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))},i=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},s=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},a={MobileNetV2:{numOfWeightBundles:1},MobileNetV2Mid:{numOfWeightBundles:2,options:{type:"graph"}},InceptionV3:{numOfWeightBundles:6,options:{size:299}}},l=function(){if("undefined"!=typeof globalThis)return globalThis;if(void 0!==n)return n;if("undefined"!=typeof window)return window;if("undefined"!=typeof self)return self;throw new Error("Unable to locate global object")};function u(e){return!!e&&e in a}var c=function(e){return o(void 0,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return(t=l().model)?[2,t]:"MobileNetV2"!==e?[3,2]:[4,import("/npm/nsfwjs@4.2.1/dist/esm/model_imports/mobilenet_v2.js/+esm")];case 1:return n=r.sent().modelJson,[3,6];case 2:return"MobileNetV2Mid"!==e?[3,4]:[4,import("/npm/nsfwjs@4.2.1/dist/esm/model_imports/mobilenet_v2_mid.js/+esm")];case 3:return n=r.sent().modelJson,[3,6];case 4:return"InceptionV3"!==e?[3,6]:[4,import("/npm/nsfwjs@4.2.1/dist/esm/model_imports/inception_v3.js/+esm")];case 5:n=r.sent().modelJson,r.label=6;case 6:return[4,n()];case 7:return[2,r.sent().default]}}))}))},d=function(e){return o(void 0,void 0,void 0,(function(){var t,n,r,o,u,c,d,f,h,p;return i(this,(function(i){switch(i.label){case 0:t=a[e].numOfWeightBundles,n=[],r=0,i.label=1;case 1:return r<t?(o="group1-shard".concat(r+1,"of").concat(t),u=o.replace(/-/g,"_"),(c=l()[u])?(n.push(((h={})[o]=c,h)),[3,10]):[3,2]):[3,11];case 2:return d=void 0,"MobileNetV2"!==e?[3,4]:[4,import("/npm/nsfwjs@4.2.1/dist/esm/model_imports/mobilenet_v2.js/+esm")];case 3:return d=i.sent().weightBundles,[3,8];case 4:return"MobileNetV2Mid"!==e?[3,6]:[4,import("/npm/nsfwjs@4.2.1/dist/esm/model_imports/mobilenet_v2_mid.js/+esm")];case 5:return d=i.sent().weightBundles,[3,8];case 6:return"InceptionV3"!==e?[3,8]:[4,import("/npm/nsfwjs@4.2.1/dist/esm/model_imports/inception_v3.js/+esm")];case 7:d=i.sent().weightBundles,i.label=8;case 8:return[4,d[r]()];case 9:f=i.sent().default,n.push(((p={})[o]=f,p)),i.label=10;case 10:return r++,[3,1];case 11:return[2,Object.assign.apply(Object,s([{}],n,!1))]}}))}))};function f(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,d(e)];case 1:return[2,t.sent()];case 2:throw t.sent(),new Error("Could not load the weight data. Make sure you are importing the correct shard files from the models directory. Ref: https://github.com/infinitered/nsfwjs?tab=readme-ov-file#browserify");case 3:return[2]}}))}))}function h(e){return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:if(!u(e))return[2,e];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,c(e)];case 2:return t=r.sent(),[4,f(e)];case 3:return n=r.sent(),[2,new m(t,n)];case 4:throw r.sent(),new Error("Could not load the model. Make sure you are importing the model.min.js bundle. Ref: https://github.com/infinitered/nsfwjs?tab=readme-ov-file#browserify");case 5:return[2]}}))}))}function p(t){return o(this,arguments,void 0,(function(t,n){var r,o,s;return void 0===n&&(n={size:224}),i(this,(function(i){switch(i.label){case 0:if(null==e)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return void 0===t?(t="MobileNetV2",console.info("%cBy not specifying 'modelOrUrl' parameter, you're using the default model: '".concat(t,"'. See NSFWJS docs for instructions on hosting your own model (https://github.com/infinitered/nsfwjs?tab=readme-ov-file#host-your-own-model)."),"color: lightblue")):u(t)&&(console.info("%cYou're using the model: '".concat(t,"'. See NSFWJS docs for instructions on hosting your own model (https://github.com/infinitered/nsfwjs?tab=readme-ov-file#host-your-own-model)."),"color: lightblue"),n=null!==(s=a[t].options)&&void 0!==s?s:n),n.size=(null==n?void 0:n.size)||224,[4,h(t)];case 1:return r=i.sent(),[4,(o=new w(r,n)).load()];case 2:return i.sent(),[2,o]}}))}))}var m=function(){function e(e,t){this.modelJson=e,this.weightDataBase64=t}return e.prototype.arrayBufferFromBase64=function(e){for(var n=t.from(e,"base64").toString("binary"),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);return o.buffer},e.prototype.load=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,o,s,a,l,u,c,d,f,h,p;return i(this,(function(i){if(e={modelTopology:this.modelJson.modelTopology,format:this.modelJson.format,generatedBy:this.modelJson.generatedBy,convertedBy:this.modelJson.convertedBy},null!=this.modelJson.weightsManifest){for(t=[],n=[],r=0,o=this.modelJson.weightsManifest;r<o.length;r++){for(s=o[r],a=0,l=s.paths;a<l.length;a++){if(u=l[a],!(c=this.weightDataBase64[u]))throw new Error("Could not find the weight data. Make sure you are importing the correct weight bundle for the model: ".concat(u,".min.js."));d=this.arrayBufferFromBase64(c),n.push(new Uint8Array(d))}t.push.apply(t,s.weights)}for(e.weightSpecs=t,f=new Uint8Array(n.reduce((function(e,t){return e+t.length}),0)),h=0,p=0;p<n.length;p++)f.set(n[p],h),h+=n[p].byteLength;e.weightData=f.buffer}return null!=this.modelJson.trainingConfig&&(e.trainingConfig=this.modelJson.trainingConfig),null!=this.modelJson.userDefinedMetadata&&(e.userDefinedMetadata=this.modelJson.userDefinedMetadata),[2,e]}))}))},e}(),w=function(){function t(t,n){this.intermediateModels={},this.options=n,this.normalizationOffset=e.scalar(255),this.urlOrIOHandler=t,"string"!=typeof t||t.startsWith("indexeddb://")||t.startsWith("localstorage://")||t.endsWith("model.json")?this.urlOrIOHandler=t:this.urlOrIOHandler="".concat(t,"model.json")}return t.prototype.load=function(){return o(this,void 0,void 0,(function(){var t,n,r,o,s,a=this;return i(this,(function(i){switch(i.label){case 0:return t=this.options,n=t.size,"graph"!==t.type?[3,2]:(r=this,[4,e.loadGraphModel(this.urlOrIOHandler)]);case 1:return r.model=i.sent(),[3,4];case 2:return o=this,[4,e.loadLayersModel(this.urlOrIOHandler)];case 3:o.model=i.sent(),this.endpoints=this.model.layers.map((function(e){return e.name})),i.label=4;case 4:return[4,(s=e.tidy((function(){return a.model.predict(e.zeros([1,n,n,3]))}))).data()];case 5:return i.sent(),s.dispose(),[2]}}))}))},t.prototype.infer=function(t,n){var r=this;if(null!=n&&-1===this.endpoints.indexOf(n))throw new Error("Unknown endpoint ".concat(n,". Available endpoints: ").concat(this.endpoints,"."));return e.tidy((function(){t instanceof e.Tensor||(t=e.browser.fromPixels(t));var o=t.toFloat().div(r.normalizationOffset),i=o,s=r.options.size;if(t.shape[0]!==s||t.shape[1]!==s){i=e.image.resizeBilinear(o,[s,s],!0)}var a,l=i.reshape([1,s,s,3]);if(null==n)a=r.model;else{if(r.model.hasOwnProperty("layers")&&null==r.intermediateModels[n]){var u=r.model.layers.find((function(e){return e.name===n}));r.intermediateModels[n]=e.model({inputs:r.model.inputs,outputs:u.output})}a=r.intermediateModels[n]}return a.predict(l)}))},t.prototype.classify=function(e){return o(this,arguments,void 0,(function(e,t){var n,r;return void 0===t&&(t=5),i(this,(function(o){switch(o.label){case 0:return[4,y(n=this.infer(e),t)];case 1:return r=o.sent(),n.dispose(),[2,r]}}))}))},t}();function y(e,t){return o(this,void 0,void 0,(function(){var n,o,s,a,l,u;return i(this,(function(i){switch(i.label){case 0:return[4,e.data()];case 1:for(n=i.sent(),o=[],u=0;u<n.length;u++)o.push({value:n[u],index:u});for(o.sort((function(e,t){return t.value-e.value})),s=new Float32Array(t),a=new Int32Array(t),u=0;u<t;u++)s[u]=o[u].value,a[u]=o[u].index;for(l=[],u=0;u<a.length;u++)l.push({className:r[a[u]],probability:s[u]});return[2,l]}}))}))}export{w as NSFWJS,p as load};export default null;
//# sourceMappingURL=/sm/2997a59e694039554b5ffe9f13a67838954485178e9da172ac4126646235e633.map